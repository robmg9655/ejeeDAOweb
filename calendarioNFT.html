<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EjeeDao Web</title>
    <script
      src="https://kit.fontawesome.com/bd9bcfe1f7.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="wrapper">
      <!-- Header nav -->
      <nav class="main-nav">
        <ul>
          <li>
            <img
              src="img/LOGOejeeDao.png"
              alt="logo-ejeedao"
              class="logo-img"
            />
          </li>
          <li>
            <a href="index.html">Home</a>
          </li>
          <li>
            <a href="calendarioNFT.html">NFTs</a>
          </li>
          <li>
            <a href="juegosweb3.html">Juegos Web3</a>
          </li>
          <li>
            <a href="contacto.html">Contacto</a>
          </li>
          <li>
            <a href="listNft.html">List NFT</a>
          </li>
          <li>
            <a href="#">Log In</a>
          </li>
        </ul>
      </nav>

      <!-- MAIN INFO -->
      <button id="addEventButton" onclick="openPasswordPopup()">
        <i class="fa-regular fa-square-plus"></i>
      </button>

      <div id="passwordPopup" class="popup">
        <div class="popup-content">
          <span class="close" onclick="closePasswordPopup()">&times;</span>
          <h2>CONTRASEÑA</h2>
          <input
            type="password"
            id="passwordInput"
            onkeypress="handleKeyPress(event)"
          />
          <button id="confirmButton" onclick="checkPassword()">
            Confirmar
          </button>
        </div>
      </div>

      <div id="eventPopup" class="popup">
        <div class="popup-content">
          <span class="close" onclick="closeEventPopup()">&times;</span>
          <h2>Añadir Evento</h2>
          <form id="eventForm">
            <label for="eventName">Nombre del evento:</label><br />
            <input type="text" id="eventName" name="eventName" required /><br />

            <label for="eventPhoto">Foto (link):</label><br />
            <input
              type="text"
              id="eventPhoto"
              name="eventPhoto"
              required
            /><br />

            <label for="eventDateTime">Fecha y hora:</label><br />
            <input
              type="datetime-local"
              id="eventDateTime"
              name="eventDateTime"
              required
            /><br />

            <label for="eventRed">Red:</label><br />
            <select id="eventRed" name="eventRed" required>
              <option value="BTC">BTC</option>
              <option value="SOL">SOL</option>
              <option value="ETH">ETH</option>
              <option value="SEI">SEI</option></select
            ><br />

            <label for="eventAmount">Cantidad:</label><br />
            <input
              type="number"
              id="eventAmount"
              name="eventAmount"
              required
            /><br />

            <label for="eventPrice">Precio:</label><br />
            <input
              type="number"
              id="eventPrice"
              name="eventPrice"
              step="0.01"
              required
            /><br />

            <label for="eventMintLink">Link minteo:</label><br />
            <input
              type="text"
              id="eventMintLink"
              name="eventMintLink"
              required
            /><br />

            <label for="eventDiscord">Discord:</label><br />
            <input
              type="text"
              id="eventDiscord"
              name="eventDiscord"
              required
            /><br />

            <label for="eventTwitter">Twitter:</label><br />
            <input
              type="text"
              id="eventTwitter"
              name="eventTwitter"
              required
            /><br />

            <button
              type="button"
              onclick="submitEvent()"
              onkeypress="handleKeyPress(event)"
            >
              Guardar
            </button>
          </form>
        </div>
      </div>

      <div class="grid-container" id="eventContainer"></div>

      <!-- Footer -->
      <footer>
        <p>EjeeDao &copy; 2024</p>
      </footer>

      <style>
        /* Estilos omitidos para mayor claridad */
      </style>

      <script>
        const addEventButton = document.getElementById("addEventButton");
        const passwordPopup = document.getElementById("passwordPopup");
        const eventPopup = document.getElementById("eventPopup");
        const eventContainer = document.getElementById("eventContainer");
        let events = []; // Array para almacenar los eventos

        // Cargar eventos almacenados al cargar la página
        window.onload = function () {
          loadEventsFromJSON();
        };

        function openPasswordPopup() {
          passwordPopup.style.display = "block";
        }

        function closePasswordPopup() {
          passwordPopup.style.display = "none";
        }

        function handleKeyPress(event) {
          if (event.key === "Enter") {
            event.preventDefault(); // Evitar que se envíe el formulario si está dentro de uno
            checkPassword();
          }
        }

        function checkPassword() {
          const passwordInput = document.getElementById("passwordInput").value;
          // Aquí puedes comparar la contraseña con la que tienes guardada
          // En este ejemplo, simplemente se compara con una contraseña fija
          if (passwordInput === "CKR") {
            openEventPopup();
            closePasswordPopup();
          } else {
            alert("Contraseña incorrecta. Por favor, inténtalo de nuevo.");
          }
        }

        function openEventPopup() {
          eventPopup.style.display = "block";
        }

        function closeEventPopup() {
          eventPopup.style.display = "none";
        }

        function submitEvent() {
          // Recoger datos del formulario
          const eventName = document.getElementById("eventName").value;
          const eventPhoto = document.getElementById("eventPhoto").value;
          const eventDateTime = document.getElementById("eventDateTime").value;
          const eventRed = document.getElementById("eventRed").value;
          const eventAmount = document.getElementById("eventAmount").value;
          const eventPrice = document.getElementById("eventPrice").value;
          const eventMintLink = document.getElementById("eventMintLink").value;
          const eventDiscord = document.getElementById("eventDiscord").value;
          const eventTwitter = document.getElementById("eventTwitter").value;

          // Crear nuevo elemento div para representar el recuadro del evento
          const eventBox = document.createElement("div");
          eventBox.classList.add("event-box");

          // Llenar el contenido del recuadro del evento con los datos del formulario
          eventBox.innerHTML = `
                <h3>${eventName}</h3>
                <img src="${eventPhoto}" alt="Event Photo">
                <p>Fecha y Hora: ${eventDateTime}</p>
                <p>Red: ${eventRed}</p>
                <p>Cantidad: ${eventAmount}</p>
                <p>Precio: ${eventPrice}</p>
                <p>Link minteo: ${eventMintLink}</p>
                <p>Discord: ${eventDiscord}</p>
                <p>Twitter: ${eventTwitter}</p>
            `;

          // Agregar el recuadro del evento al contenedor
          eventContainer.appendChild(eventBox);

          // Añadir evento al array
          addEvent(eventName, eventDateTime);

          // Guardar eventos en el archivo JSON
          saveEventsToJSON();

          // Cerrar el popup después de enviar el formulario
          closeEventPopup();
        }

        // Función para agregar un evento
        function addEvent(eventName, eventDateTime) {
          const event = {
            eventName: eventName,
            eventDateTime: new Date(eventDateTime),
            // Otros campos del evento...
          };

          // Calcular el tiempo restante hasta el evento
          const timeUntilEvent = event.eventDateTime - Date.now();

          // Programar la eliminación del evento una hora después de la fecha y hora del evento
          setTimeout(() => {
            deleteEvent(event);
          }, timeUntilEvent + 3600000); // Sumamos una hora en milisegundos
        }

        // Función para eliminar un evento
        function deleteEvent(event) {
          const index = events.indexOf(event);
          if (index !== -1) {
            events.splice(index, 1);
            console.log(
              `Evento '${event.eventName}' eliminado automáticamente una hora después de su fecha y hora programadas.`
            );

            // Guardar eventos actualizados en el archivo JSON
            saveEventsToJSON();
          }
        }

        // Función para guardar los eventos en el archivo JSON
        function saveEventsToJSON() {
          // Convertir el array de eventos a formato JSON
          const eventsJSON = JSON.stringify(events);

          // Guardar los datos en el archivo events.json
          // Puedes implementar la lógica para guardar en el servidor si es necesario
          localStorage.setItem("events", eventsJSON);
        }

        // Función para cargar los eventos almacenados del archivo JSON
        function loadEventsFromJSON() {
          const eventsJSON = localStorage.getItem("events");
          if (eventsJSON) {
            events = JSON.parse(eventsJSON);
            // Mostrar eventos en la página
            events.forEach((event) => {
              addEventToPage(event);
            });
          }
        }

        // Función para agregar un evento a la página
        function addEventToPage(event) {
          const eventBox = document.createElement("div");
          eventBox.classList.add("event-box");
          eventBox.innerHTML = `
                <h3>${event.eventName}</h3>
                <p>Fecha y Hora: ${event.eventDateTime}</p>
            `;
          eventContainer.appendChild(eventBox);
        }
      </script>
    </div>
  </body>
</html>
